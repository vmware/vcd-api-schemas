swagger: "2.0"
info:
  description: |
    The vCloud Director compute policy API allows to create and view compute policies in vDC and provider vDC.
  version: "2.0"
  title: vCloud Director compute policy API

paths:
  vdc-compute-policies:
    get:
      x-vcloud-multisite: true
      tags:
        - vdcComputePolicies2
      summary: Get list of organization VDC compute policies.
      description: |
        Get list of organization VDC compute policy.
        <br>
        Results can be filtered by:
        <ul>
          <li> id
          <li> name
          <li> pvdcId
          <li> isSizingOnly
          <li> policyType
          <li> vdc.id
          <li> pvdcComputePolicy.id
          <li> pvdc
          <li> isAutoGenerated
          <li> _context
         <ul>
        <br>
        Supported contexts are:
        Org VDC Urn ID (_context==orgVdcUrn) - |
        <br>
        Returns all the VDC compute policies which are available to a specific Org VDC.
      x-vcloud-added-in: 35.0
      operationId: queryVdcComputePolicies
      parameters:
        - $ref: "./common/query.yaml#/parameters/queryFilter"
        - $ref: "./common/query.yaml#/parameters/querySortAsc"
        - $ref: "./common/query.yaml#/parameters/querySortDesc"
        - $ref: "./common/query.yaml#/parameters/queryPage"
        - $ref: "./common/query.yaml#/parameters/queryPageSize"
      produces:
        - application/json
      responses:
        200:
          description: OK
          schema:
            $ref: "#/definitions/VdcComputePolicies2"

    post:
      tags:
        - vdcComputePolicies2
      summary: Creates a new organization VDC compute policy
      description: |
        Creates a new VDC compute policy. if PolicyType is VdcKubernetesPolicy,
        then the response is a 202 with task URL in location header. For
        VdcVmPolicy type, the response is 201 with created policy in response body.
      x-vcloud-added-in: 35.0
      operationId: createVdcComputePolicy
      consumes:
        - application/json
      parameters:
        - name: newVdcComputePolicyParams
          in: body
          required: true
          schema:
            $ref: "#/definitions/VdcComputePolicy2"
      produces:
        - application/json
      responses:
        201:
          description: Created
          schema:
            $ref: "#/definitions/VdcComputePolicy2"
        202:
          $ref: "./common/response.yaml#/components/responses/Accepted"
        400:
          $ref: "./common/response.yaml#/components/responses/BadRequest"

  vdc-compute-policy:
    parameters:
      - name: vdcComputePolicyId
        in: path
        required: true
        type: string
        x-vcloud-constraints:
          - constraint: Urn
            args:
              - arg: vdcComputePolicy
    get:
      tags:
        - vdcComputePolicies2
      summary: Get specified organization VDC compute policy
      x-vcloud-added-in: 35.0
      operationId: getVdcComputePolicy
      produces:
        - application/json
      responses:
        200:
          description: OK
          schema:
            $ref: "#/definitions/VdcComputePolicy2"
        404:
          description: Not Found
    put:
      tags:
        - vdcComputePolicies2
      summary: Update specified organization VDC compute policy
      description: |
        Updates vDC compute policy. if PolicyType is VdcKubernetesPolicy,
        then the response is a 202 with task URL in location header. For
        VdcVmPolicy type, the response is 200 with updated policy in response body.
      x-vcloud-added-in: 35.0
      operationId: updateVdcComputePolicy
      consumes:
        - application/json
      parameters:
        - name: updateVdcComputePolicyParams
          in: body
          required: true
          schema:
            $ref: "#/definitions/VdcComputePolicy2"
      produces:
        - application/json
      responses:
        200:
          description: OK
          schema:
            $ref: "#/definitions/VdcComputePolicy2"
        202:
          $ref: "./common/response.yaml#/components/responses/Accepted"
        400:
          $ref: "./common/response.yaml#/components/responses/BadRequest"
    delete:
      tags:
        - vdcComputePolicies2
      summary: Delete specified organization VDC compute policy.
      description: |
        Deletes vDC compute policy. if PolicyType is VdcKubernetesPolicy,
        then the response is a 202 with task URL in location header, else
        204 is returned.
      x-vcloud-added-in: 35.0
      operationId: deleteVdcComputePolicy
      responses:
        204:
          description: No Content
        202:
          $ref: "./common/response.yaml#/components/responses/Accepted"

  vdc-compute-policy-metrics:
    parameters:
      - name: vdcComputePolicyId
        in: path
        required: true
        type: string
        x-vcloud-constraints:
          - constraint: Urn
            args:
              - arg: vdcComputePolicy
    get:
      tags:
        - vdcComputePolicies2
      summary: Get specified organization VDC compute policy metrics.
      description: |
         Returns metrics for the given compute policy. Returns 400 if
         the policyType does not support metrics. For example, if type of
         the policy is VdcVmPolicy, then this API returns a 400 BadRequest response.
      x-vcloud-added-in: 35.0
      operationId: getVdcComputePolicyMetrics
      produces:
        - application/json
      responses:
        200:
          description: OK
          schema:
            $ref: "#/definitions/VdcComputePolicyMetrics"
        400:
          $ref: "./common/response.yaml#/components/responses/BadRequest"

  virtual-machine-classes-vdc-policy:
    parameters:
      - name: vdcComputePolicyId
        in: path
        required: true
        type: string
        x-vcloud-constraints:
          - constraint: Urn
            args:
              - arg: vdcComputePolicy
    get:
      tags:
        - vdcComputePolicies2
      summary: Get a list of Virtual Machine Classes associated with this policy.
      description: |
        Get a list of Virtual Machine Classes associated with this policy.
        Returns 400 if policy type is anything but VdcKubernetesPolicy.
      x-vcloud-added-in: 35.0
      operationId: queryVirtualMachineClasses
      parameters:
        - $ref: "./common/query.yaml#/parameters/queryFilter"
        - $ref: "./common/query.yaml#/parameters/querySortAsc"
        - $ref: "./common/query.yaml#/parameters/querySortDesc"
        - $ref: "./common/query.yaml#/parameters/queryPage"
        - $ref: "./common/query.yaml#/parameters/queryPageSize"
      produces:
        - application/json
      responses:
        200:
          description: OK
          schema:
            $ref: "#/definitions/VirtualMachineClasses"
        400:
          $ref: "./common/response.yaml#/components/responses/BadRequest"

  virtual-machine-classes-pvdc-policy:
    parameters:
      - name: pvdcComputePolicyId
        in: path
        required: true
        type: string
        x-vcloud-constraints:
          - constraint: Urn
            args:
              - arg: pvdcComputePolicy
    get:
      tags:
        - pvdcComputePolicies2
      summary: Get a list of Virtual Machine Classes associated with this policy.
      description: |
        Get a list of Virtual Machine Classes associated with this policy.
        Returns 400 if policy type is anything but PvdcKubernetesPolicy.
      x-vcloud-added-in: 35.0
      operationId: queryVirtualMachineClasses
      parameters:
        - $ref: "./common/query.yaml#/parameters/queryFilter"
        - $ref: "./common/query.yaml#/parameters/querySortAsc"
        - $ref: "./common/query.yaml#/parameters/querySortDesc"
        - $ref: "./common/query.yaml#/parameters/queryPage"
        - $ref: "./common/query.yaml#/parameters/queryPageSize"
      produces:
        - application/json
      responses:
        200:
          description: OK
          schema:
            $ref: "#/definitions/VirtualMachineClasses"
        400:
          $ref: "./common/response.yaml#/components/responses/BadRequest"

  vdc-refs:
    parameters:
      - name: vdcComputePolicyId
        in: path
        required: true
        type: string
        x-vcloud-constraints:
          - constraint: Urn
            args:
              - arg: vdcComputePolicy

    post:
      tags:
        - vdcComputePolicies2
      summary: Assign this organization VDC compute policy to list of VDCs.
      x-vcloud-added-in: 35.0
      operationId: addVdcComputePolicyToVdcs
      consumes:
        - application/json
      parameters:
        - name: vdcRefs
          in: body
          required: true
          schema:
            type: array
            items:
              $ref: "#/definitions/EntityReference"
      produces:
        - application/json
      responses:
        200:
          description: OK
          schema:
            type: array
            items:
              $ref: '#/definitions/EntityReference'
    get:
      tags:
        - vdcComputePolicies2
      summary: Get orgatization VDCs this VDC compute policy has been assigned/published to
      x-vcloud-added-in: 35.0
      operationId: getVdcComputePolicyVdcs
      produces:
        - application/json
      responses:
        200:
          description: OK
          schema:
            type: array
            items:
              $ref: '#/definitions/EntityReference'
        404:
          description: Not Found

  pvdc-compute-policies:
    get:
      tags:
        - pvdcComputePolicies2
      summary: Get list of provider vDC compute policies.
      description: |
        Get list of provider vDC compute policies. Only filtering by provider vDC compute policy name is supported.
      x-vcloud-added-in: 35.0
      operationId: queryPvdcComputePolicies
      parameters:
        - $ref: "./common/query.yaml#/parameters/queryFilter"
        - $ref: "./common/query.yaml#/parameters/querySortAsc"
        - $ref: "./common/query.yaml#/parameters/querySortDesc"
        - $ref: "./common/query.yaml#/parameters/queryPage"
        - $ref: "./common/query.yaml#/parameters/queryPageSize"
      produces:
        - application/json
      responses:
        200:
          description: OK
          schema:
            $ref: "#/definitions/PvdcComputePolicies2"
    post:
      tags:
        - pvdcComputePolicies2
      summary: Creates a new provider vDC compute policy
      description: |
        Creates a new pVDC compute policy
      x-vcloud-added-in: 35.0
      operationId: createPvdcComputePolicy
      consumes:
        - application/json
      parameters:
        - name: pvdcComputePolicy
          in: body
          required: true
          schema:
            $ref: "./compute-policy/compute-policy-2.0.0.yaml#/definitions/PvdcComputePolicy2"
      produces:
        - application/json
      responses:
        201:
          description: Created
          schema:
            $ref: "#/definitions/PvdcComputePolicy2"
        202:
          $ref: "./common/response.yaml#/components/responses/Accepted"
        400:
          $ref: "./common/response.yaml#/components/responses/BadRequest"

  pvdc-compute-policy:
    parameters:
      - name: pvdcComputePolicyId
        in: path
        description: ID of provider vDC Compute Policy
        required: true
        type: string
        x-vcloud-constraints:
          - constraint: Urn
            args:
              - arg: pvdcComputePolicy
    get:
      tags:
        - pvdcComputePolicies2
      summary: Get specified provider vDC compute policy
      x-vcloud-added-in: 35.0
      operationId: getPvdcComputePolicy
      produces:
        - application/json
      responses:
        200:
          description: OK
          schema:
            $ref: "#/definitions/PvdcComputePolicy2"
        404:
          description: Not Found
    put:
      tags:
        - pvdcComputePolicies2
      summary: Update specified provider vDC compute policy
      x-vcloud-added-in: 35.0
      operationId: updatePvdcComputePolicy
      consumes:
        - application/json
      parameters:
        - name: pvdcComputePolicyId
          in: path
          description: ID of provider vDC Compute Policy
          required: true
          type: string
        - name: pvdcComputePolicy
          in: body
          required: true
          schema:
            $ref: "#/definitions/PvdcComputePolicy2"
      produces:
        - application/json
      responses:
        200:
          description: OK
          schema:
            $ref: "#/definitions/PvdcComputePolicy2"
    delete:
      tags:
        - pvdcComputePolicies2
      summary: Delete specified provider vDC compute policy.
      x-vcloud-added-in: 35.0
      operationId: deletePvdcComputePolicy
      responses:
        204:
          description: No Content

  pvdc-compute-policy-metrics:
    parameters:
      - name: pvdcComputePolicyId
        in: path
        required: true
        type: string
        x-vcloud-constraints:
          - constraint: Urn
            args:
              - arg: pvdcComputePolicy
    get:
      tags:
        - pvdcComputePolicies2_Dummy
      summary: Get specified provider vDC compute policy metrics
      description: |
         Returns metrics for the given compute policy. Returns 400 if
         the policyType does not support metrics. For example, if type of
         the policy is PvdcVmPolicy, then this API returns a 400 BadRequest response.
      x-vcloud-added-in: 35.0
      operationId: getPvdcComputePolicyMetrics
      produces:
        - application/json
      responses:
        200:
          description: OK
          schema:
            $ref: "#/definitions/PvdcComputePolicyMetrics"
        400:
          $ref: "./common/response.yaml#/components/responses/BadRequest"

  pvdc-vm-policies:
    get:
      tags:
        - pvdcComputePolicies2_Dummy
      summary: Get all VMs associated with this pVDC compute policy
      operationId: getPvdcComputePolicyVms
      produces:
        - application/json
      responses:
        200:
          description: OK
          schema:
            $ref: '#/definitions/PvdcVmPolicy'
        404:
          description: Not Found

  pvdc-tkg-policies:
    get:
      tags:
        - pvdcComputePolicies2_Dummy
      summary: Get all VMs associated with this pVDC compute policy
      operationId: getPvdcComputePolicyVms
      produces:
        - application/json
      responses:
        200:
          description: OK
          schema:
            $ref: '#/definitions/PvdcKubernetesPolicy'
        404:
          description: Not Found

  pvdc-policy-metrics:
    get:
      tags:
        - pvdcComputePolicies2_Dummy
      summary: Get Provider vDC Kubernetes policy metrics
      operationId: getPvdcComputePolicyMetrics
      produces:
        - application/json
      responses:
        200:
          description: OK
          schema:
            $ref: '#/definitions/PvdcKubernetesPolicyMetrics'
        404:
          description: Not Found

  vdc-vm-policies:
    get:
      tags:
        - vdcComputePolicies2_Dummy
      summary: Get all VMs associated with this vDC compute policy
      operationId: getVdcComputePolicyVms
      produces:
        - application/json
      responses:
        200:
          description: OK
          schema:
            $ref: '#/definitions/VdcVmPolicy'
        404:
          description: Not Found

  vdc-tkg-policies:
    get:
      tags:
        - vdcComputePolicies2_Dummy
      summary: Get all VMs associated with this vDC compute policy
      operationId: getVdcComputePolicyVms
      produces:
        - application/json
      responses:
        200:
          description: OK
          schema:
            $ref: '#/definitions/VdcKubernetesPolicy'
        404:
          description: Not Found

  vdc-policy-metrics:
    get:
      tags:
        - vdcComputePolicies2_Dummy
      summary: Get Vdc Kubernetes policy metrics
      operationId: getVdcKubernetesPolicyMetrics
      produces:
        - application/json
      responses:
        200:
          description: OK
          schema:
            $ref: '#/definitions/VdcKubernetesPolicyMetrics'
        404:
          description: Not Found

  supported-kubernetes-versions:
    parameters:
      - name: vdcComputePolicyId
        in: path
        required: true
        type: string

    get:
      tags:
        - vdcComputePolicies2NonPublic
      summary: Get the supported Kubernetes Versions for a particular compute policy
      operationId: getSupportedKubernetesVersions
      x-vcloud-added-in: 35.0
      produces:
        - application/json
      responses:
        200:
          description: OK
          schema:
            $ref: '#/definitions/SupportedKubernetesVersions'

definitions:

  VdcComputePolicy2:
    type: object
    x-vcloud-added-in: 35.0
    discriminator: policyType
    description: |
       vDC compute policy that contains vDC specific configuration for workloads. (Version 2.0.0)
    properties:
      id:
        type: string
        description: |
          UUID for vDC compute policy. This is immutable.
      description:
        type: string
        minLength: 1
        maxLength: 256
        default: "A vDC compute policy."
        x-vcloud-constraints:
          - constraint: NonSortable
          - constraint: NonSearchable
      policyType:
        type: string
        description: |
          The discriminator type is used to differentiate among various sub policy types.
      name:
        type: string
        minLength: 1
        maxLength: 128
        required: true
        description: |
          Display name.
      pvdcComputePolicy:
        description: |
              This field cannot be updated and is a read-only field in the client after creation.
        x-vcloud-constraints:
          - constraint: NonSortable
        $ref: '#/definitions/EntityReference'
      compatibleVdcTypes:
          type: array
          x-vcloud-restricted: |
              Restricted field, requires 'View Alternate Admin version of Compute Policies for an Organization vDC' right to access this field.
          description: A list of read-only compatible vDC types for this policy.
          items:
            type: string
      isSizingOnly:
          type: boolean
          readOnly: true
          description: |
             This field cannot be updated and is a read-only field in the client after creation. It defines whether
             the policy is SIZING_ONLY or if it also contains affinity information.
      pvdcId:
          type: string
          x-vcloud-restricted: |
             Restricted field, requires 'View Alternate Admin version of Compute Policies for an Organization vDC' right to access this field.
          description: |
             URN for Provider vDC.
          x-vcloud-constraints:
            - constraint: NonSortable
            - constraint: Urn
              args:
                - arg: providervdc
      isAutoGenerated:
          type: boolean
          x-vcloud-constraints:
              - constraint: ReadOnly
          description: |
             It is a read-only field. It indicates whether the policy is auto-generated.
    x-vcloud-cross-references:
      - cross-reference:
          x-vcloud-added-in: 35.2
          alias: pvdc
          description: |
            A filter to look up vDC compute policies that refer to a global placement policy
            (PvdcComputePolicy) belonging to the given PVDC.
            Supported filters:
              pvdc==urn:vcloud:providervdc:${UUID}
    required:
      - name
      - policyType
    example:
       description: |
          This is an example payload to create a policy of type VdcKubernetesPolicy.
          Follow /1.0.0/vdcComputePolicies example to know payload to create a VdcVmPolicy type
          of compute policy. Note that policyType field will have to be added to the payload taken
          from /1.0.0/vdcComputePolicies example, if you are using /2.0.0/vdcComputePolicies.
       policyType: VdcKubernetesPolicy
       name: myPolicy
       pvdcComputePolicy:
         name: nameOfPvdcPolicy
         id: urn:vcloud:pvdcComputePolicy:494f4a50-09ce-4ba7-913b-3fde593bc7ef
       kubernetesConfig:
         storageClasses:
           - storageClass: gold
             limit: 20480
           - storageClass: silver
             limit: 10240
         virtualMachineClasses:
           - best-effort-xsmall
           - best-effort-small
         namespaceResourceSpec:
           cpuLimit: 1000
           memoryLimit: 1024
           memoryReservationGuarantee: 1.0
           cpuReservationGuarantee: 1.0
       vdc:
         name: vdc1
         id: urn:vcloud:vdc:f8dfe02d-47e5-4e3c-ba71-f0d67810d0ef
    x-vcloud-property-annotations:
      pvdcComputePolicy:
        x-vcloud-added-in: 35.0
        x-vcloud-restricted: |
          Restricted field, requires 'View Alternate Admin version of Compute Policies for an Organization vDC' right to access this field.

  VdcVmPolicy:
    x-vcloud-added-in: 35.0
    description: |
       Policy configuration that is applicable to virtual machines.
    allOf:
      - $ref: "./compute-policy/compute-policy-2.0.0.yaml#/definitions/VdcComputePolicy2"
      - type: object
        properties:
         cpuSpeed:
           type: integer
           format: int64
           description: |
             The CPU speed in MHz of this VM. This is optional. When provided,
             VMs with this policy cannot have more than CPU speed defined by this field.
           x-vcloud-constraints:
             - constraint: NonSortable
             - constraint: NonSearchable
         memory:
           type: integer
           format: int64
           description: |
             The maximum memory in MB allowed for a VM. This is optional. When provided, VMs with
             this policy cannot have configured memory more than defined by this field.
           x-vcloud-constraints:
             - constraint: NonSortable
             - constraint: NonSearchable
         cpuCount:
           type: integer
           format: int32
           description: |
              The maximum number of CPUs allowed for a VM. This is optional. When provided,
              VMs with this policy cannot have more than number of CPUs defined by this field.
           x-vcloud-constraints:
             - constraint: NonSortable
             - constraint: NonSearchable
         coresPerSocket:
           type: integer
           format: int32
           description: |
              The cores per socket to be configured for the VM where this policy is applied.
           x-vcloud-constraints:
             - constraint: NonSortable
             - constraint: NonSearchable
         memoryReservationGuarantee:
           type: number
           x-vcloud-restricted: |
               Restricted field, requires 'View Alternate Admin version of Compute Policies for an Organization vDC' right to access this field.
           format: double
           minimum: 0
           exclusiveMinimum: false
           maximum: 1
           exclusiveMaximum: false
           description: |
               The factor of the configured memory reserved for the VM on which this policy is applied.
           x-vcloud-constraints:
             - constraint: NonSortable
             - constraint: NonSearchable
         cpuReservationGuarantee:
           type: number
           x-vcloud-restricted: |
               Restricted field, requires 'View Alternate Admin version of Compute Policies for an Organization vDC' right to access this field.
           format: double
           minimum: 0
           exclusiveMinimum: false
           maximum: 1
           exlusiveMaximum: false
           description: |
               The factor of the configured CPU reserved for the VM on which this policy is applied.
           x-vcloud-constraints:
             - constraint: NonSortable
             - constraint: NonSearchable
         cpuLimit:
           type: integer
           x-vcloud-restricted: |
                Restricted field, requires 'View Alternate Admin version of Compute Policies for an Organization vDC' right to access this field.
           format: int64
           description: |
                The limit of CPU in MHz for the VM on which this policy is applied. -1 means unlimited. This
                is optional. If not provided, limit would be equal to the vCPUSpeed multiplied by numCPU.
           x-vcloud-constraints:
             - constraint: NonSortable
             - constraint: NonSearchable
         memoryLimit:
           type: integer
           x-vcloud-restricted: |
               Restricted field, requires 'View Alternate Admin version of Compute Policies for an Organization vDC' right to access this field.
           format: int64
           description: |
                The limit of memory in MB for the VM on which this policy is applied. -1 means unlimited. This
                is optional. If not provided, limit would be equal to the configured memory of the VM.
           x-vcloud-constraints:
             - constraint: NonSortable
             - constraint: NonSearchable
         cpuShares:
           type: integer
           x-vcloud-restricted: |
               Restricted field, requires 'View Alternate Admin version of Compute Policies for an Organization vDC' right to access this field.
           format: int32
           description: |
                The number of CPU shares for the VM on which this policy is applied. This is optional. If
                not provided, Normal shares would be applied to the VM.
           x-vcloud-constraints:
             - constraint: NonSortable
             - constraint: NonSearchable
         memoryShares:
           type: integer
           x-vcloud-restricted: |
               Restricted field, requires 'View Alternate Admin version of Compute Policies for an Organization vDC' right to access this field.
           format: int32
           description: |
                 The number of memory shares for the VM on which this policy is applied. This is optional. If
                 not provided, Normal shares would be applied to the VM.
           x-vcloud-constraints:
             - constraint: NonSortable
             - constraint: NonSearchable
         extraConfigs:
           type: object
           x-vcloud-restricted: |
               Restricted field, requires 'View Alternate Admin version of Compute Policies for an Organization vDC' right to access this field.
           description: |
                 Map of extra configs to be set on the VM with this policy.
           x-vcloud-constraints:
             - constraint: NonSortable
             - constraint: NonSearchable
           additionalProperties:
             type: string
         namedVmGroups:
             type: array
             x-vcloud-deprecated-in: 35.2
             x-vcloud-deprecated-alternative: pvdcNamedVmGroupsMap
             x-vcloud-restricted: |
                Restricted field, requires 'View Alternate Admin version of Compute Policies for an Organization vDC' right to access this field.
             items:
               type: array
               items:
                 $ref: '#/definitions/EntityReference'
             description: |
               List of list of vmGroups grouped together in a meaningful manner.
               A group of vmGroups would consist of one functionally equal vmGroup picked from each cluster of the provider vDC.
             x-vcloud-constraints:
               - constraint: NonSortable
               - constraint: NonSearchable
         pvdcNamedVmGroupsMap:
             type: array
             x-vcloud-restricted: |
                Restricted field, requires 'View Alternate Admin version of Compute Policies for an Organization vDC' right to access this field.
             x-vcloud-added-in: 35.2
             items:
               type: object
               properties:
                pvdc:
                  description: |
                     EntityReference of provider vDC.
                  $ref: '#/definitions/EntityReference'
                namedVmGroups:
                  type: array
                  items:
                    type: array
                    items:
                      $ref: '#/definitions/EntityReference'
             description: |
               Map of pvdcIds to its vmGroups grouped together in a meaningful manner.
               A group of vmGroups would consist of one functionally equal vmGroup picked from each cluster of the provider vDC.
             x-vcloud-constraints:
               - constraint: NonSortable
               - constraint: NonSearchable
         logicalVmGroupReferences:
             type: array
             x-vcloud-deprecated-in: 35.2
             x-vcloud-deprecated-alternative: pvdcLogicalVmGroupsMap
             x-vcloud-restricted: |
                Restricted field, requires 'View Alternate Admin version of Compute Policies for an Organization vDC' right to access this field.
             description: |
               List of logical vm group references. This value is set at creation time and cannot be edited later.
             items:
               $ref: '#/definitions/EntityReference'
             x-vcloud-constraints:
               - constraint: NonSortable
               - constraint: NonSearchable
         pvdcLogicalVmGroupsMap:
             type: array
             x-vcloud-restricted: |
                Restricted field, requires 'View Alternate Admin version of Compute Policies for an Organization vDC' right to access this field.
             x-vcloud-added-in: 35.2
             items:
               type: object
               properties:
                pvdc:
                  description: |
                     EntityReference of provider vDC.
                  $ref: '#/definitions/EntityReference'
                logicalVmGroups:
                  type: array
                  items:
                    $ref: '#/definitions/EntityReference'
             description: |
               Map of pvdcIds to its logical vmGroups.
             x-vcloud-constraints:
               - constraint: NonSortable
               - constraint: NonSearchable

  VdcKubernetesPolicy:
    x-vcloud-added-in: 35.0
    description: |
       Policy configuration that is applicable to Kubernetes clusters.
    allOf:
      - $ref: "./compute-policy/compute-policy-2.0.0.yaml#/definitions/VdcComputePolicy2"
      - type: object
        properties:
          supervisorNamespaceName:
            type: string
            description: |
              The supervisor namespace name.
          kubernetesConfig:
            $ref: "./compute-policy/compute-policy-2.0.0.yaml#/definitions/KubernetesConfig"
          vdc:
             description: |
                EntityReference of vDC to which this policy needs to be scoped. This policy
                is automatically published to this vDC and cannot be published to any other
                vDC. This field cannot be updated after policy creation.
             x-vcloud-constraints:
               - constraint: NonSortable
             $ref: '#/definitions/EntityReference'
        required:
           - vdc
    x-vcloud-property-annotations:
      supervisorNamespaceName:
        x-vcloud-added-in: 35.2
        x-vcloud-restricted: |
          Restricted field, requires 'View Alternate Admin version of Compute Policies for an Organization vDC' right to access this field.


  VdcComputePolicies2:
    description: |
      A list of vDC compute policies. (Version 2.0.0)
    allOf:
      - $ref: '#/definitions/Page'
      - type: object
        properties:
          values:
            type: array
            description: The current page of vDC compute policies.
            items:
              $ref: '#/definitions/VdcComputePolicy2'

  PvdcComputePolicy2:
    type: object
    x-vcloud-added-in: 35.0
    discriminator: policyType
    description: |
       Pvdc compute policy that contains PVDC specific configuration for workloads. (Version 2.0.0)
    properties:
      id:
        type: string
        description: |
          UUID for pVDC compute policy. This is immutable.
      name:
        type: string
        minLength: 1
        maxLength: 128
        description: |
          Display name.
      policyType:
        type: string
        description: |
          The discriminator type is used to differentiate among various sub policy types.
      description:
        type: string
        default: ""
        minLength: 1
        maxLength: 256
        x-vcloud-constraints:
          - constraint: NonSortable
          - constraint: NonSearchable
      pvdcId:
        type: string
        description: |
          URN for Provider vDC. If not provided, then this policy
          is considered Global.
        x-vcloud-constraints:
          - constraint: Urn
            args:
              - arg: providervdc
    x-vcloud-cross-references:
      - cross-reference:
          x-vcloud-added-in: 35.2
          alias: pvdc
          description: |
            A filter to look up PVDC compute policies belonging to the given PVDC.
            An empty global policy belongs to all PVDCs and hence will be returned
            by this filter too.
            Supported filters:
              pvdc==urn:vcloud:providervdc:${UUID}
    required:
      - name
      - policyType
    example:
       description: |
          This is an example payload to create a policy of type PvdcKubernetesPolicy.
          Follow /1.0.0/pvdcComputePolicies example to know payload to create a PvdcVmPolicy type
          of compute policy. Note that policyType field will have to be added to the payload taken
          from /1.0.0/pvdcComputePolicies example, if you are using /2.0.0/pvdcComputePolicies.
       policyType: PvdcKubernetesPolicy
       name: myPolicy
       pvdcId: urn:vcloud:providervdc:d1c4cc73-f111-4bc2-a361-e91839c061c9
       supervisorCluster:
         moref: domain-c8
         name: test-cluster
       kubernetesConfig:
         storageClasses:
           - storageClass: gold
             limit: 20480
           - storageClass: silver
             limit: 10240
         virtualMachineClasses:
           - best-effort-xsmall
           - best-effort-small
         namespaceResourceSpec:
           cpuLimit: 1000
           memoryLimit: 1024
           memoryReservationGuarantee: 1.0
           cpuReservationGuarantee: 1.0

  PvdcVmPolicy:
    x-vcloud-added-in: 35.0
    description: |
       Policy configuration that is applicable to virtual machines.
    allOf:
      - $ref: "./compute-policy/compute-policy-2.0.0.yaml#/definitions/PvdcComputePolicy2"
      - type: object
        properties:
         namedVmGroups:
             type: array
             x-vcloud-deprecated-in: 35.2
             x-vcloud-deprecated-alternative: pvdcNamedVmGroupsMap
             items:
               type: array
               items:
                 $ref: '#/definitions/EntityReference'
             description: |
               List of vmGroups grouped together in a meaningful manner.
               A group of vmGroups would consist of one functionally equal vmGroup picked from each cluster of the provider vDC.
         pvdcNamedVmGroupsMap:
             type: array
             x-vcloud-added-in: 35.2
             items:
               type: object
               properties:
                pvdc:
                  description: |
                     EntityReference of provider vDC.
                  $ref: '#/definitions/EntityReference'
                namedVmGroups:
                  type: array
                  items:
                    type: array
                    items:
                      $ref: '#/definitions/EntityReference'
             description: |
               Map of pvdcIds to its vmGroups grouped together in a meaningful manner.
               A group of vmGroups would consist of one functionally equal vmGroup picked from each cluster of the provider vDC.
         logicalVmGroupReferences:
             type: array
             x-vcloud-deprecated-in: 35.2
             x-vcloud-deprecated-alternative: pvdcLogicalVmGroupsMap
             description: |
               This field cannot be updated and is a read-only field after creation.
             items:
               $ref: '#/definitions/EntityReference'
         pvdcLogicalVmGroupsMap:
             type: array
             x-vcloud-added-in: 35.2
             items:
               type: object
               properties:
                pvdc:
                  description: |
                     EntityReference of provider vDC.
                  $ref: '#/definitions/EntityReference'
                logicalVmGroups:
                  type: array
                  items:
                    $ref: '#/definitions/EntityReference'
             description: |
               Map of pvdcIds to its logical vmGroups.
    x-vcloud-property-annotations:
      namedVmGroups:
        x-vcloud-constraints:
          - constraint: NonSortable
          - constraint: NonSearchable
      pvdcNamedVmGroupsMap:
        x-vcloud-constraints:
          - constraint: NonSortable
          - constraint: NonSearchable
      logicalVmGroupReferences:
        x-vcloud-constraints:
          - constraint: NonSortable
          - constraint: NonSearchable
      pvdcLogicalVmGroupsMap:
        x-vcloud-constraints:
          - constraint: NonSortable
          - constraint: NonSearchable

  PvdcKubernetesPolicy:
    x-vcloud-added-in: 35.0
    description: |
       Policy configuration that is applicable to Kubernetes clusters.
    allOf:
      - $ref: "./compute-policy/compute-policy-2.0.0.yaml#/definitions/PvdcComputePolicy2"
      - type: object
        properties:
          supervisorCluster:
            type: object
            description: |
              Supervisor cluster. This field cannot be changed after creation.
            properties:
              moref:
                type: string
                description: |
                  Moref of the supervisor cluster.
              name:
                type: string
                x-vcloud-constraints:
                    - constraint: ReadOnly
                description: |
                  Name of the supervisor cluster. This is a read-only field.
            required:
               - moref
          kubernetesConfig:
            $ref: "./compute-policy/compute-policy-2.0.0.yaml#/definitions/KubernetesConfig"
        required:
           - supervisorClusterMoref

  KubernetesConfig:
    type: object
    x-vcloud-added-in: 35.0
    description: |
            Kubernetes config needed to create TKG clusters.
    properties:
      storageClasses:
        type: array
        description: |
          Storage classses and their limits to be used in supervisor namespace created from
          this policy.
        items:
          type: object
          properties:
            storageClass:
              type: string
              description: |
                Name of the storage class.
            limit:
              type: integer
              format: int64
              description: |
                Default limit of storage from this storage class.
      virtualMachineClasses:
        type: array
        description: |
          Virtual machine classses to be used in supervisor namespace created from
          this policy.
        items:
          type: string
      namespaceResourceSpec:
         type: object
         description: |
            Various resource spec values to be used in supervisor namespace created from
            this policy.
         properties:
            cpuLimit:
               type: integer
               format: int64
               description: |
                  CPU limit in MHz for the underlying namespace created from this policy.
                  Unlimited if left empty.
            memoryLimit:
               type: integer
               format: int64
               description: |
                   Memory limit in MB for the underlying namespace created from this policy.
                   Unlimited if left empty.
            memoryReservationGuarantee:
               type: number
               format: double
               minimum: 0
               exclusiveMinimum: false
               maximum: 1
               exclusiveMaximum: false
               description: |
                   The factor of the configured memory reserved.
            cpuReservationGuarantee:
               type: number
               format: double
               minimum: 0
               exclusiveMinimum: false
               maximum: 1
               exclusiveMaximum: false
               description: |
                  The factor of the configured CPU reserved for the VM on which this policy is applied.
         required:
            - virtualMachineClasses
            - storageClasses

  PvdcComputePolicies2:
    description: |
      A list of provider vDC compute policies. (Version 2.0.0)
    allOf:
      - $ref: '#/definitions/Page'
      - type: object
        properties:
          values:
            type: array
            description: The current page of provider vDC compute policies.
            items:
              $ref: '#/definitions/PvdcComputePolicy2'

  PvdcComputePolicyMetrics:
    type: object
    x-vcloud-added-in: 35.0
    discriminator: policyMetricsType
    description: |
       Metrics for Pvdc compute policy
    properties:
      policyMetricsType:
        type: string
        description: |
          The discriminator type is used to differentiate among various sub policy metrics types.
    required:
      - policyMetricsType

  PvdcKubernetesPolicyMetrics:
    x-vcloud-added-in: 35.0
    description: |
       Metrics for PvdcKubernetesPolicy
    allOf:
      - $ref: "./compute-policy/compute-policy-2.0.0.yaml#/definitions/PvdcComputePolicyMetrics"
      - $ref: "./compute-policy/compute-policy-2.0.0.yaml#/definitions/KubernetesPolicyMetrics"

  KubernetesPolicyMetrics:
    x-vcloud-added-in: 35.0
    description: |
       Metrics for KubernetesPolicy
    type: object
    properties:
      cpuMetrics:
        type: object
        properties:
          totalCpuMHz:
            type: integer
            format: int64
            description: |
              Total CPU available in MHz.
          cpuUsedMHz:
            type: integer
            format: int64
            description: |
              Total CPU used in MHz.
          totalCpuReservationMHz:
            type: integer
            format: int64
            description: |
              Total CPU reservation available in MHz.
          cpuReservationUsedMHz:
            type: integer
            format: int64
            description: |
              Total CPU reservation used in MHz.
      memoryMetrics:
        type: object
        properties:
          totalMemoryMB:
            type: integer
            format: int64
            description: |
              Total Memory available in MB.
          memoryUsedMB:
            type: integer
            format: int64
            description: |
              Total memory used in MB.
          totalMemoryReservationMB:
            type: integer
            format: int64
            description: |
              Total Memory reservation available in MB.
          memoryReservationUsedMB:
            type: integer
            format: int64
            description: |
              Total Memory reservation used in MB.
      storageMetrics:
        type: array
        items:
          type: object
          properties:
            storageClassName:
              type: string
              description: |
                Name of the storage class.
            totalStorageMB:
              type: integer
              format: int64
              description: |
                Total Storage available in MB.
            storageUsedMB:
              type: integer
              format: int64
              description: |
                Storage used in MB.

  VdcComputePolicyMetrics:
    type: object
    x-vcloud-added-in: 35.0
    discriminator: policyMetricsType
    description: |
       Metrics for Vdc compute policy
    properties:
      policyMetricsType:
        type: string
        description: |
          The discriminator type is used to differentiate among various sub policy type metrics.
    required:
      - policyMetricsType

  VdcKubernetesPolicyMetrics:
    x-vcloud-added-in: 35.0
    description: |
       Metrics for VdcKubernetesPolicy
    allOf:
      - $ref: "./compute-policy/compute-policy-2.0.0.yaml#/definitions/VdcComputePolicyMetrics"
      - $ref: "./compute-policy/compute-policy-2.0.0.yaml#/definitions/KubernetesPolicyMetrics"

  VirtualMachineClass:
    type: object
    x-vcloud-added-in: 35.0
    description: |
       In a Tanzu Kubernetes cluster Virtual Machine Classes reserve a set of resources for the VM including cpu, memory, and storage.
    properties:
      name:
        type: string
        description: |
          Name of the Virtual Machine Class.
        x-vcloud-constraints:
          - constraint: ReadOnly
      cpuReservationRequestedMHz:
        type: integer
        format: int64
        description: |
          CPU in MHz that a node reserves when this VirtualMachineClass is applied to the node of a Kubernetes cluster.
        x-vcloud-constraints:
          - constraint: ReadOnly
      memoryReservationRequestedMB:
        type: integer
        format: int64
        description: |
          Memory in MB that a node reserves when this VirtualMachineClass is applied to the node of a Kubernetes cluster.
        x-vcloud-constraints:
          - constraint: ReadOnly
      cpuCount:
        type: integer
        format: int32
        description: |
          Number of CPUs that a node gets when this VirtualMachineClass is applied to the node of a Kubernetes cluster.
        x-vcloud-constraints:
          - constraint: ReadOnly
      memoryMB:
        type: integer
        format: int64
        description: |
          Memory in MB that a node gets when this VirtualMachineClass is applied to the node of a Kubernetes cluster.
        x-vcloud-constraints:
          - constraint: ReadOnly
      isFullyReserved:
        type: boolean
        description: |
          This read-only field conveys whether CPU and memory resources are fully reserved or not when this VirtualMachineClass is applied to the node of the Kubernetes cluster.
        x-vcloud-constraints:
          - constraint: ReadOnly

  VirtualMachineClasses:
    x-vcloud-added-in: 35.0
    description: |
      A list of Virtual Machine Classes.
    allOf:
      - $ref: '#/definitions/Page'
      - type: object
        properties:
          values:
            type: array
            description: The current page Virtual Machine Classes.
            items:
              $ref: './compute-policy/compute-policy-2.0.0.yaml#/definitions/VirtualMachineClass'

  SupportedKubernetesVersions:
    x-vcloud-added-in: 35.0
    description: |
      The supported Kubernetes versions
    properties:
      supportedVersions:
        type: array
        items:
          type: string
      description: |
        The supported Kubernetes versions in the form of a comma separated list, e.g: w,x,y,z
    x-vcloud-property-annotations:
      supportedVersions:
        x-vcloud-constraints:
          - constraint: ReadOnly


  EntityReferences:
    $ref: "./common/entity.yaml#/definitions/EntityReferences"
  EntityReference:
    $ref: "./common/entity.yaml#/definitions/EntityReference"